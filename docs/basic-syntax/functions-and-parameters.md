## 函数与参数传递

函数是 C++ 程序设计的基本构建块，它允许将代码组织成独立的、可重用的模块。函数可以接收参数，执行特定的操作，然后返回结果。理解函数的定义、调用、参数传递方式以及调用惯例是编写高效 C++ 代码的关键。

### 1. **函数的定义与声明**

函数的定义包括函数的返回类型、名称、参数列表和函数体。函数的声明（或原型）是在函数定义之前给出的一种简化形式，用于告诉编译器函数的存在和它的签名。

#### 1.1 **函数定义**

```cpp
int add(int a, int b) {
    return a + b;
}
```

#### 1.2 **函数声明**

```cpp
int add(int, int);
```

### 2. **参数传递方式**

C++ 支持几种不同的参数传递方式，每种方式具有不同的特性和适用场景。

#### 2.1 **值传递**

值传递是将参数的副本传递给函数。函数内部对参数的修改不会影响到调用函数的实际参数。

```cpp
void increment(int x) {
    x = x + 1;
}

int main() {
    int a = 5;
    increment(a);
    std::cout << a << std::endl;  // 输出: 5
}
```

#### 2.2 **指针传递**

指针传递是将参数的地址传递给函数。函数可以通过指针修改实际参数的值。

```cpp
void increment(int* x) {
    *x = *x + 1;
}

int main() {
    int a = 5;
    increment(&a);
    std::cout << a << std::endl;  // 输出: 6
}
```

#### 2.3 **引用传递**

引用传递是将参数的引用传递给函数，函数可以直接修改实际参数的值，并且语法上与值传递类似，但实际上是传递了原始数据的引用。

```cpp
void increment(int& x) {
    x = x + 1;
}

int main() {
    int a = 5;
    increment(a);
    std::cout << a << std::endl;  // 输出: 6
}
```

#### 2.4 **常量引用传递**

常量引用传递用于传递大型对象而不复制它们，同时保证函数不会修改这些对象。适用于需要读访问但不希望修改的情况。

```cpp
void printValue(const std::string& str) {
    std::cout << str << std::endl;
}

int main() {
    std::string s = "Hello, World!";
    printValue(s);
}
```

### 3. **函数重载**

C++ 支持函数重载，即在同一个作用域中定义多个同名但参数列表不同的函数。函数重载的决定是基于参数的数量和类型。

```cpp
int add(int a, int b) {
    return a + b;
}

double add(double a, double b) {
    return a + b;
}
```

### 4. **默认参数**

C++ 允许在函数声明中指定默认参数值。如果调用函数时没有提供这些参数，则使用默认值。

```cpp
void printMessage(const std::string& msg = "Hello") {
    std::cout << msg << std::endl;
}

int main() {
    printMessage();  // 输出: Hello
    printMessage("Hi");  // 输出: Hi
}
```

### 5. **调用惯例（Calling Conventions）**

调用惯例定义了函数调用时参数的传递方式、返回值的处理、堆栈的使用等细节。了解调用惯例有助于优化代码并解决低级语言中的兼容性问题。

#### 5.1 **C 调用惯例**

在 C++ 中，通常采用 C 调用惯例（`cdecl`）。这种惯例要求调用者清理堆栈，函数返回值通常保存在寄存器中。它允许函数重载，并且参数可以通过堆栈传递。

#### 5.2 **C++ 调用惯例**

C++ 调用惯例与 C 调用惯例类似，但也支持类成员函数的调用，这些函数在内部会使用不同的调用约定。类成员函数的调用惯例涉及到 `this` 指针的处理。

#### 5.3 **Windows 调用惯例**

在 Windows 系统中，除了 `cdecl` 外，还支持 `stdcall` 和 `fastcall` 调用惯例。`stdcall` 由被调用者清理堆栈，适用于 Windows API 函数；`fastcall` 使用寄存器传递参数，提高了调用效率。

### 6. **总结**

理解函数的定义、声明、参数传递方式和调用惯例对于编写高效且可靠的 C++ 代码至关重要。通过正确使用这些功能，可以实现模块化、可维护的代码，同时优化程序的执行性能。
